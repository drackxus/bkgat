<?php
global $current_user;
  wp_get_current_user();
  if (is_user_logged_in()) {
      $loginUser = "true";
      $idUser = $current_user->ID;
      $nameUser = get_user_meta($idUser, 'user_nombre', true).' '. get_user_meta($idUser, 'user_apellido', true);
      $cantidad_retos2 = 7;
      if(get_user_meta($idUser, 'notificacion_reto', true) == '') {
        $meta_query[] = array(
            'key' => 'estado',
            'value' => 'activo',
            'compare' => '=',
            'type' => 'char'
        );
        $args = array(
        	'numberposts' => 10,
        	'orderby' => 'post_date',
        	'order' => 'DESC',
        	'post_type' => 'retos',
        	'post_status' => 'publish',
            'meta_query' => $meta_query
        );
        
        $recent_posts = get_posts($args);
        $number_notify = $cantidad_retos2 + count($recent_posts);
        // update_user_meta($idUser, 'notificacion_reto', date("Y-m-d"));
      } else {
        $fecha_notify = get_user_meta($idUser, 'notificacion_reto', true);
        $meta_query[] = array(
            'key' => 'estado',
            'value' => 'activo',
            'compare' => '=',
            'type' => 'char'
        );
        $args = array(
        	'numberposts' => 10,
        	'orderby' => 'post_date',
        	'order' => 'DESC',
        	'post_type' => 'retos',
        	'post_status' => 'publish',
            'date_query' => array(
                'after' => $fecha_notify,
                'before' => 'today',
                'inclusive' => true,
            ),
            'meta_query' => $meta_query
        );
        
        $recent_posts = get_posts($args);
        $number_notify = count($recent_posts);
        // update_user_meta($idUser, 'notificacion_reto', date("Y-m-d"));
      }
      ?>
       <?php
      if(wp_is_mobile())
      {
      ?>
      <style>
        .notify {
                width: 30px;
                height: 30px;
                border-radius: 50%;
                background: black;
                display: inline-flex;
                position: absolute;
                top: -1px;
                left: 96px;
                margin-left: -9px;
                justify-content: center;
                align-items: center;
                color: white;
                font-size: 16px;
        }
      </style>
      <?php
      }
      else
      {
      ?>
      <style>
        .notify {
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #F2610F;
            display: inline-flex;
            position: relative;
            top: -13px;
            left: 8px;
            margin-left: -9px;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 11px;
        }
      </style>
      <?php
      }
      ?>
      <?php
      if(count($recent_posts) > 1) { 
      ?>
      <span class="notify"><?php echo $number_notify; ?></span>
      <?php
      }
  }






















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































